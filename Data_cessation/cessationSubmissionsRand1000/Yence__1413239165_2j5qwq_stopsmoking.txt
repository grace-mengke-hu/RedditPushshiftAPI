Planning to quit again - fear the reasons why I started smoking again: lethargy and depressed episodes

I quit smoking a few months ago but only for a few weeks until I had a "fuck this shit" moment when I just didn't care about myself anymore, wanted a break and bought a pack. Have been smoking again since then. Have been assembling courage to quit again for a few weeks now, but every time my pack is finished I just buy a new one and say to myself "I'll stop after this one". This thought has become a bad habit, too. I read Allen Carr's book and will do it again.

One of the worst symptoms I had was lethargy: I was sleeping and resting unusually much and was very lazy in general. Had the tendency to drink a lot more coffee, which gave me a very weird state of mind because a non-smoker is a lot more sensitive to caffeine. Combined with the lethargy, this even sometimes resulted in falling asleep with a lot of caffeine in my system. This resulted in dreams in 3D Dolby Surround which were not pleasent at all. This was not really a "reason" to start smoking again, but I really would like some advice on how to deal with this in a new attempt. Perhaps I should change more habits than just quitting smoking?

And otherwise, which was a "reason" for me to start smoking again, was a "fuck this shit" moment - bought a pack of cigarettes, and started smoking again without even thinking about it. And now I feel like the fact that I'm smoking is one of the reasons why I'm unhappy with myself, contributing to mild depression. So in a way I could say to myself "wether you smoke or not, you'll be unhappy anyway", I guess.

95% of my friends are smokers too, and although a few of them have taken one or more attempts to quit, none of them succeeded. This also makes it very hard to persist.

I am from the late 80ies and have been smoking for almost 6 years now. I've had enough. I've already taken two attempts, so I experienced where the hard part is, but I haven't really figured out yet how to deal with that when I (hopefully) quit for good.