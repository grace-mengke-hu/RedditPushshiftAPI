How to help my boyfriend quit smoking

I’m sure this topic has been brought up a million times before, so I apologize. My boyfriend (21) has been smoking for 3 -4 years, and he’s worked his way up to a pack a day for the past 6 months. He has severe asthma, which obviously is being made drastically worse by smoking. He coughs up black stuff all the time and has coughing fits in which he can barely breathe and it scares me to death. He refuses to go to the doctor because he’s scared they’ll tell him he has cancer. He’s tried to quit multiple times and he’s had success, but he always has a setback at school. He’s taking classes to be a mechanic and a welder, and all of his classmates vape and smoke. The school gives them smoke breaks, which doesn’t help either. He’s been 3 months cigarette-free and he ends it by bumming cigarettes off of his classmates and other people who go to the school. I also used to be a smoker and I asked him why he smoked and he just said “because I like it.” His view is that he’s addicted to the act of smoking more than the nicotine itself. He’s tried vaping in the past, but he says it’s not the same. The other day, he finished the last cigarette in the pack and said “okay this is it” and promised not to buy another pack again. No more than 20 minutes later, he stopped at the store to “get us some drinks” because we were going on a walk in a nature preserve and he came out with just a pack of cigarettes and he told me he didn’t have enough money for the drinks. He just gets mad when I say something negative when he buys a pack, so I’ve stopped doing that. He begs me for help, but won’t accept (what I think is) help. Most of his setbacks happen when he’s away from me, so I feel like I can’t even help him anymore. It upsets me so much that his health is declining and he’s only 21. What can I do? What am I doing wrong?