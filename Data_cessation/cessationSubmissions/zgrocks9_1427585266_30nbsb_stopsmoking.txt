Struggling once again

I've been a smoker for about 5 and a half years. The last time I quit, roughly two years ago, I lasted about 6 months before relapsing, and I've been smoking since. 

I want to quit, I try roughly once a month, but I have so many triggers around me. I work as a server, and more than half of the other servers smoke and it draws me out back to smoke with them. My closest friend smokes as well, and she doesn't want to quit, so I'm always around her smoking, which draws me back into it as well. I thought that by starting yoga again at school it would help, but 9 weeks in and I'm still smoking after each class. My great-grandmother just passed away last night from COPD, and I don't want to end up like that. 

What can I do to finally win this battle? I have the desire, just not the willpower I guess. 

Congrats for everyone else, I will one day be among the ranks of non-smokers! 