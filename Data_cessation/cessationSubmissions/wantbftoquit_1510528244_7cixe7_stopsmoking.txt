Hurt and upset because boyfriend started smoking again. How do I help him quit when all his friends smoke?

My bf &amp; I have been together 4 years. When we started dating, he didn't tell me he was a smoker &amp; I never thought to ask. He did know that I am inherently opposed to smoking as he knew about my anti-tobacco advocacy work. He never smoked in front of me or his family so I never noticed. 

I found out he was a smoker a couple of months into our relationship. By that time, he had moved about 5 hours away for school (last semester) so I saw him once or twice a month in person. Everyone in his friend circle smoked. He told me he smoked up to 13 cigs each day. I was really upset and didn't know how to react because never in my life had I imagined I would be dating a smoker. I thought I should tell him to quit, but on the other hand my mind said, he is an adult, it is his life, I shouldn't tell him what to do. 

After graduating the semester, he moved back to my city, got a job etc. Our relationship was getting serious but I found it hard to talk to him about the smoking because thinking about it made me really upset. I told him straight up that I will date him because I like him, but I can never live with or marry a smoker, so if our relationship is going anywhere, he has to quit. 

Soon after, he quit. He told me about a few lapses of occasional smoking, but also about how amazing his body felt. It was as if he could breathe clearly again. He could run and play sports without getting exhausted. I was so proud of him &amp; reminded him of that. He didn't smoke for almost 2 years. I asked every 6 months or so if he smoked &amp; he would happily say no. 

He came up to me a few days ago &amp; told me he had started smoking again since the past month, about 5 cigs a day. It was killing him to hide it from me. Idk why but I was so hurt &amp; disappointed. I cried and couldn't even look at him or kiss him. He said he is telling me this because he wants to quit for good and has downloaded a cessation app to help him quit. 

I understand that smoking is an addiction, but I just couldn't understand why he picked up smoking again after he had quit for 2 years. I am really trying to be supportive of his quitting again because I love this man and want to help him. But I also know some of his co-worker buddies &amp; his close friends who he still hangs out with most weekends are all smokers. This past weekend we went to a party where 5 of his close friends &amp; their SOs stepped outside at least 4 times in 4 hours to smoke. They asked him to come along &amp; I could see his face that he wanted to, but he didn't because I was there. 

I felt really hurt because I saw these couples having a smoke together &amp; that is something we can never have. It was like I didn't belong there &amp; I felt like me being there was restricting him from smoking with his friends. I cannot &amp; will not tell him to not hang out with his friends (who are really cool people minus the smoking), but I don't know how he can ever stop smoking for good when all the people he works with and hangs out with (except me) smoke? 

Sorry for the rant, I just feel incredibly alone and hurt by this though smoking may be a non-issue for many couples. He is a wonderful person, and I want to trust him and support him in his quit process but every day he goes to work or out with his friends on the weekend, my brain automatically assumes he smoked. I don't ask because apparently I'm not supposed to ask, nag or lecture him (according to some websites I read) but if I don't ask, how do I even know if he is sticking to his cessation? Just thinking about this makes me incredibly sad :( 

TL;DR Bf started smoking again after quitting for 2 years. Want to help him quit, but all his friends and co-workers smoke. How can he quit when he is always around smokers? 

