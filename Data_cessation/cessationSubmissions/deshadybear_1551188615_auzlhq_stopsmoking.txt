So I broke, how would you make sure it doesn't happen again?

Truthfully this is the second Tuesday night I've broken in a row. I haven't smoked in so long and these karaoke nights I find myself with a new group of friends. 

Last Tuesday I drank quite a bit and began socialising with this new group of friends who smoke. I guess I chose to smoke but it happened and my willpower wasn't there when I was that drunk. I had 6 over the night and the next morning I hated myself for it and swore to not drink next week as to not smoke. 

I found myself incredibly anxious and you guessed it when one of the lads pulled out a pack I swamped it like it was the end of the world and had eight. I now reek of cigarettes and loath the withdrawals I'm going to have to deal with on top of the huge stress I'm going through. 

I want to do this karaoke night but I can't break for a third week in a row. I want to get back to how I felt 6 months clean. It's so disheartening having gone so long and now having my lungs feel heavy and reaking of cigarette.

What's the subreddits thoughts? How would you manage? :/ 