Unable to quit

I quit smoking four months ago, since then I have found myself slipping in periods of high stress, when drinking and around friends. The beginning was very optimistic but two months went by and the cravings kept coming back, since then I have reset the quit timer multiple times and yet I find myself craving that one cigarette before I quit for good. How do you deal with these periods of stress? The cravings around your friends, or suddenly when you think back on your life as a smoker? I tried the Allen Carr book the first time and have been trying hard not to crave again, but every time I try to quit, I am only reminded that  these cravings that won't cease over time.