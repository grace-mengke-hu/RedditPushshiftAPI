Quit for two months, relapsed

How do you deal with your friends smoking? I go out and all of them smoke. I drink and feel the urge to smoke.
I read an article on the web and every once in a while I see people smoking. I watch a movie and people smoke.
Also seems like my depression got worse since I quit, I read somewhere nicotine has antidepressant effects. I drink coffee and I want to smoke.
After two months, something bad happened and started smoking again. I feel guilty and disappointed. Thinking about quitting again, but I'm not convinced entirely. I'm not in a very good mental state ( for reason not connected with smoking )I must admit.
