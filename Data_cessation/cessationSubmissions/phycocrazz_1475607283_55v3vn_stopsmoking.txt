I can't stop tricking myself into having a cigarette

Long story short I have severe unknown stomach problem that causes bad bowel movements that vary from once a week to 15 times a day. 

I lasted 3.5 days of Stoptober before I relapsed because my stomach began to hurt and I couldn't bare adding more pain to something that has really damaged my life mentally and physically.

 I'm trying to not see it as a failure- I've restarted my days smoke free app and I've brushed it off. I've told myself that I will have one cigarette when it hurts like if I am in so much pain like I was today because I don't want to add insult to injury until I know what's causing my stomach such problems.


The only problem is; I have an upcoming surgery that I've been waiting for, for 7 years! (It is a cosmetic chest surgery that is quite vital for my mental stability) and I KNOW I have to quit and I thought the surgery itself would be enough motivation to quit but I fell for that damn mind game that convinced me to smoke. 

I'm trying to stay positive but I'm very angry with myself - this is more of a rant I needed to get off my chest but if any of you gave up smoking for surgery please feel free to give me some advice.

Thanks