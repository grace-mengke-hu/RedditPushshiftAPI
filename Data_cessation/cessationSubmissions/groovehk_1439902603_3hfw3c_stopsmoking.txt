Long time lurker/smoker, help :(

Been smoking for pretty much exactly half of my life.  I never really peaked over five or ten a day, but recently I've noticed the 'need' to buy a new pack almost everyday. 

Ever since the hangovers started actually hurting, I've also noticed that my lungs are also not what they once were.

Problem is, I just can't seem to stop. I've quit for possibly a week total in all this time.

I'm running a marathon in around two months which should be a strong enough kicker, and yet I'm smoking more now than I probably ever have.

I've read Allen Carr, twice, even been on the course and it still didn't work.

What do I do?!? 