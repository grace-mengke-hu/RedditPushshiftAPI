How not to smoke when partying with friends?

 I was never a heavy smoker. Sometimes weeks went by with not a single cigarette, I occasionally had one or two cigarettes at work with colleges at the end of a work day. For a very long time I was okay with that but then the smoking at work became a regular thing and all of the sudden there was not a single day passing by without a smoke. That is when I realized I need to quit once and for all because I am on a slippery slope. Now since I guess I was never really physically addicted to nicotine but more to the habit itself, I had not great difficulties to quit at the beginning of the year. Now my problem is when I start drinking alkohol my desire to smoke gets multiplied. With one beer I am still fine but as soon as I get drunk I lose all my self control towards smoking. I know myself pretty well so what did I do? I avoided going out for drinks for 4 months. Then last week it was a friends birthday and we went out to celebrate and I smoked a whole package of cigarettes because I got wasted! 
I have seriously no clue how to control this but simply avoid this situations. Problem is I don't want to stay at home all the time and never celebrate with my friends- I don't do it often but its occasionally a lot of fun. I am amazed how soon I started smoking last week- it took me only two beers to loose all my resolutions. 
How do you handle this?

Edit: I went back to zero cigarettes directly after the night out. I am just afraid that this will happen all over again next time I am out.