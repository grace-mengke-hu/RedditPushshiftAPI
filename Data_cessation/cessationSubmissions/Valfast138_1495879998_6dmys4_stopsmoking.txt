Need advice

Ahoy!
I am 23 yo, been smoking since I was 13 (****ing idiot).
I have been trying to quit for a long time, and I always end up smoking again.
I quit for periods of months and other times I held up for a few days only.
I tried the pills that suppress the need to smoke or nicotine but it didn't help, I noticed that what triggers it most are the surroundings  to be more specific - my friends. I started working out, which helped me reduce the amount I smoke but never really quit, I can go through the whole week without smoking but when I go out with friends (not even bars but just to go out somewhere to eat etc') and I see them smoke, I get this craving again even though I haven't smoked for a week.
Any suggestions?